---
title: "Beste portofolio"
output:
  flexdashboard::flex_dashboard:
    storyboard: true
---

```{r setup, include=FALSE}
# load libraries
library(flexdashboard)
library(plotly)
library(tidyverse)
library(spotifyr)
library(dplyr)
library(compmus)

# load playlists
billboard_2016 <- get_playlist_audio_features("", "2PcWcjfLFYUhVLh2dpa4zF")
billboard_2017 <- get_playlist_audio_features("", "3ZQvaXiJCZCSEgei9GVIJp")
billboard_2018 <- get_playlist_audio_features("", "6Qvc2MPgTjWwGuC1uSvbgu")
billboard_2019 <- get_playlist_audio_features("", "6OapfKmVO7KhOBLBsAUcj3")
billboard_2020 <- get_playlist_audio_features("", "3RQ0FTTe6QqiyRT7LpD9Uq")
billboard_2021 <- get_playlist_audio_features("", "3pkikocxs7ubWxrm6JnBBV")
billboard_2022 <- get_playlist_audio_features("", "14i68vJsrTAg2c66qBDYdA")
tiktok_2018 <- get_playlist_audio_features("", "4IjkLsdqg38MPMCB6jTVZ8")
tiktok_2019 <- get_playlist_audio_features("", "3Os2qwqVkreV4yfsV1VR9e")
tiktok_2020 <- get_playlist_audio_features("", "542KyzCbLiTv3JYIA01qVw")
tiktok_2021 <- get_playlist_audio_features("", "3rcnWnLbLdhv5ywbckRezp")
tiktok_2022 <- get_playlist_audio_features("", "61yLxL3ZHR1uU0K893M7Gy")

# make column track.duration_s that shows track duration in seconds
billboard_2016_2022 <- rbind(billboard_2016, billboard_2017, billboard_2018, billboard_2019, billboard_2020, billboard_2021, billboard_2022) %>%
  mutate(track.duration_s = track.duration_ms / 1000)
tiktok_2018_2022 <- rbind(tiktok_2018, tiktok_2019, tiktok_2020, tiktok_2021, tiktok_2022) %>%
  mutate(track.duration_s = track.duration_ms / 1000)

# make column year that divides all songs by year in which they were trending
x <- c(rep(2016, 100), rep(2017, 100), rep(2018, 100), rep(2019, 100), rep(2020, 100), rep(2021, 100), rep(2022, 100))
billboard_2016_2022$year <- factor(x)
y <- c(rep(2018, 76), rep(2019, 224), rep(2020, 357), rep(2021, 331), rep(2022, 267))
tiktok_2018_2022$year <- factor(y)

# make a dataframe with all songs in it
all_songs <- rbind(billboard_2016_2022, tiktok_2018_2022)

# make column that states if it's tiktok or billboard
z <- c(rep("Billboard", 700), rep("TikTok", 1255))
all_songs$type <- factor(z)
```

### Introduction

TikTok is one of the most popular social media apps of today and had a big impact on how we navigate our online life and also on music.

In this dashboard I will visualize how music changed as TikTok got more popular. My corpus contains top hits from 2016 until 2022 and a playlist containing the all-time biggest TikTok sounds. By analyzing these playlists I want to see if through the time, the popular music converges more to the TikTok sounds. If developments in music are found, we cannot necessarily contribute those to Tiktok, but I think it is safe to assume that the rise of Tiktok has played somewhat of a role.

A noteworthy example I would like to research is the song 'Running up the Hills" by Kate Bush, a song originally from the 1980's, that was repopularized by the series Stranger Things and Tiktok, does that fit in with the overall trend?

For my datasets I have used the Billboard Year-End Hot 100 singles of the years 2016 to 2022 for the popular songs. For the TikTok charts I have used the website https://tokboard.com and the datasets of the user Sveta151 on kaggle (https://www.kaggle.com/sveta151).

### Running up the Hills chromagram

```{r}
hills <-
  get_tidy_audio_analysis("75FEaRjZTKLhTrFGsfMUXR") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

hills |>
  mutate(pitches = map(pitches, compmus_normalise, "euclidean")) |>
  compmus_gather_chroma() |> 
  ggplot(
    aes(
      x = start + duration / 2,
      width = duration,
      y = pitch_class,
      fill = value
    )
  ) +
  geom_tile() +
  labs(x = "Time (s)", y = NULL, fill = "Magnitude") +
  theme_minimal() +
  scale_fill_viridis_c()
```

***

* I'm not yet sure what I could say with a chromagram, but a lot of C's on this one.

### DTP of popular TikTok song

```{r}
unholy <-
  get_tidy_audio_analysis("3nqQXoyQOWXiESFLlDF1hG") |>
  select(segments) |>
  unnest(segments) |>
  select(start, duration, pitches)

compmus_long_distance(
  unholy |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  unholy |> mutate(pitches = map(pitches, compmus_normalise, "chebyshev")),
  feature = pitches,
  method = "euclidean"
) |>
  ggplot(
    aes(
      x = xstart + xduration / 2,
      width = xduration,
      y = ystart + yduration / 2,
      height = yduration,
      fill = d
    )
  ) +
  geom_tile() +
  coord_equal() +
  labs(x = "Unholy", y = "Unholy", fill = "distance") +
  theme_minimal() +
  scale_fill_viridis_c()

```

***

* This is a DTP of the most popular song in the entire database: Unholy by Sam Smith and Kim Petras. You can clearly see the bridge just after second 100 that clearly clashes with the rest of the song (as the distance is the biggest in this part). But overall the song is apparently very similar to itself in most parts.
* For the other DTP I want to find the most popular song of the TikTok songs that is not in the Billboard charts and see how that compares to the DTP already shown. I just don't know yet how to find the first one.
* I have to say that with this visualization I'm very open to feedback and tips on what things I could find, because I'm not very sure what I'm looking for and how to look for it.

### Songs are getting shorter

```{r}
track_duration_table <- billboard_2016_2022 %>%
  group_by(year) %>%
  summarise(median_track_duration_s = median(track.duration_s),
            mean_track_duration_s = mean(track.duration_s))

track_duration <- ggplot(track_duration_table, aes(year, mean_track_duration_s, group=1)) +
  geom_line() +
  geom_point() +
  theme_bw() +
  labs(
    x = "Year",
    y = "Mean track duration in seconds",
    title = "Popular songs have gotten shorter",
    subtitle = "The track duration of the most popular songs in 2016 and 2022"
  )

ggplotly(track_duration)
```

***

* We can see that the track duration has significantly gone down since TikTok got popular. TikTok started in 2017, but had already gained significant populairty in 2019 and this has since then only been rising.
* With the rise of TikTok the attention span of teenagers has been going down. This also includes songs, so to become popular, the song should not be too long, for the attention span of most listeners are not this long anymore.


### Danceability seems to follow a trend in both the TikTok and the Billboard chart

```{r}
# make a table that shows mean danceability per year
danceability_table <- all_songs %>%
  group_by(type, year) %>%
  summarise(mean_danceability = mean(danceability))

# plot mean danceability per year
danceability <- ggplot(danceability_table, aes(year, mean_danceability, color = type)) +
  geom_line(aes(group = type)) +
  geom_hline(yintercept = mean(tiktok_2018_2022$danceability), color = "#00BFC4", size = 1) +
  annotate("text", x=2, y=mean(tiktok_2018_2022$danceability) + 0.003, label="Mean TikTok", size=3) +
  geom_hline(yintercept = mean(billboard_2016_2022$danceability), color = "#F8766D", size = 1) +
  annotate("text", x=6, y=mean(billboard_2016_2022$danceability) + 0.003, label="Mean Billboard", size=3) +
  labs(
    x = "Year",
    y = "Mean danceability",
    title = "Danceability seems to follow a trend in both charts",
    subtitle = "From 2020 onwards TikTok and Billboard follow the same trend in regards to danceability"
  )

# show plot
ggplotly(danceability)
```

***

* We can see that the mean danceability is higher for popular TikTok songs than for songs that were in the Billboard Hot 100. 
* It is also notable that the trend in the last three years are very similar for both chart-types.
* This last point can be contributed to the fact that TikTok gained the most popularity in 2020 and it could be said that popular music and TikTok trends had a bigger influence on each other.

### Conclusion

Conclusion. TikTok has an effect on music.